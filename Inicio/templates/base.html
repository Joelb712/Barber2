{% load static %}
<!-- templates/base.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{% block title %}Fede BarberShop{% endblock %}</title>

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">

  <!-- Tu CSS personalizado (si defines estilos como .glass, asegúrate de tenerlos aquí) -->
  <link rel="stylesheet" href="{% static 'css/base.css' %}"> 

</head>
<body class="min-h-screen flex flex-col justify-between font-poppins">
  <!-- Header fijo -->
  <header class="fixed top-0 left-0 w-full z-50 glass px-6 py-4 shadow-md">
  <div class="flex justify-between items-center">
    <!-- Logo -->
    <h1 class="text-2xl font-bold text-white">
      <a href="{% url 'Inicio' %}" class="hover:text-yellow-300 transition">Barber Studio</a>
    </h1>

    <!-- Botón hamburguesa -->
    <button id="menu-btn" class="text-white md:hidden focus:outline-none focus:ring-2 focus:ring-yellow-400 p-2 rounded">
      <!-- ícono hamburguesa -->
      <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
          d="M4 6h16M4 12h16M4 18h16" />
      </svg>
    </button>

    <!-- Navegación principal -->
    <nav id="menu" class="hidden md:block">
      <ul class="flex flex-col md:flex-row items-center gap-4 md:gap-6 text-sm font-medium text-white">
        <li><a href="{% url 'Inicio' %}" class="hover:text-yellow-500 transition {% if es_index %}text-gray-400 cursor-not-allowed pointer-events-none{% endif %}">Inicio</a></li>
        <li><a href="#servicios" class="hover:text-yellow-500 transition {% if not es_index %}text-gray-400 cursor-not-allowed pointer-events-none{% endif %}">Servicios</a></li>
        <li><a href="#productos" class="hover:text-yellow-500 transition {% if not es_index %}text-gray-400 cursor-not-allowed pointer-events-none{% endif %}">Productos</a></li>
        <li><a href="#nosotros" class="hover:text-yellow-500 transition {% if not es_index %}text-gray-400 cursor-not-allowed pointer-events-none{% endif %}">Nosotros</a></li>
        <li><a href="#reserva" class="hover:text-yellow-500 transition {% if not es_index %}text-gray-400 cursor-not-allowed pointer-events-none{% endif %}">Reserva</a></li>
        <li><a id="divContacto" href="{% url 'contacto' %}" class="hover:text-yellow-500 transition">Contacto</a></li>

        {% if user.is_authenticated %}
          <!-- <li><a href="{% url 'dash' %}" class="hover:text-yellow-500 transition">Dash</a></li> -->
          {% if request.user.is_superuser %}
            <li><a href="{% url 'admin:index' %}" class="hover:text-yellow-500 transition">Administrador</a></li>
          {% endif %}


          <li class="relative" id="user-menu">
            <button id="user-menu-button" class="flex items-center gap-2 focus:outline-none">
              <img src="{% if cliente and cliente.foto %}{{ cliente.foto.url }}{% else %}https://cdn-icons-png.flaticon.com/512/1077/1077012.png{% endif %}"
                    alt="Foto de perfil"
                    class="w-10 h-10 rounded-full border-2 border-yellow-400 object-cover">
              <span class="text-yellow-400 font-semibold hidden md:inline">
                {{ user.first_name|default:user.username }}
              </span>
            </button>

            <div id="user-dropdown"
                  class="absolute right-0 mt-2 w-48 bg-black/80 backdrop-blur-md text-white rounded-xl shadow-lg hidden transition-opacity duration-200">
              <ul class="text-sm divide-y divide-gray-700">
                <li>
                  <a href="{% url 'mis_turnos' %}" 
                      class="block px-4 py-2 hover:bg-yellow-500 hover:text-black transition">
                      Ver mis turnos
                  </a>
                </li>
                <li>
                  <a href="{% url 'perfil_cliente' %}" 
                      class="block px-4 py-2 hover:bg-yellow-500 hover:text-black transition">
                      Ver perfil
                  </a>
                </li>
                <li>
                  <form method="post" action="{% url 'logout' %}">
                    {% csrf_token %}
                    <button type="submit"
                      class="w-full text-left px-4 py-2 hover:bg-red-600 transition">
                      Cerrar sesión
                    </button>
                  </form>
                </li>
              </ul>
            </div>
          </li>



        {% else %}
          <li>
            <a href="{% url 'login' %}" class="bg-yellow-500 hover:bg-yellow-600 text-black px-4 py-1.5 rounded font-semibold text-sm transition duration-200">
              Iniciar sesión
            </a>
          </li>
        {% endif %}
      </ul>
    </nav>
  </div>

  <!-- Menú desplegable (solo visible en móvil) -->
  <div id="mobile-menu" class="hidden md:hidden mt-3 bg-black/60 backdrop-blur-xl rounded-xl p-4">
    <ul class="flex flex-col items-center gap-4 text-white text-sm font-medium">
      <li><a href="#servicios" data-target="servicios" class="mobile-link hover:text-yellow-400 transition">Servicios</a></li>
      <li><a href="#productos" data-target="productos" class="mobile-link hover:text-yellow-400 transition">Productos</a></li>
      <li><a href="#nosotros" data-target="nosotros" class="mobile-link hover:text-yellow-400 transition">Nosotros</a></li>
      <li><a href="#reserva" data-target="reserva" class="mobile-link hover:text-yellow-400 transition">Reserva</a></li>
      <li><a id="divmobileContacto" href="{% url 'contacto' %}" class="mobile-link hover:text-yellow-400 transition">Contacto</a></li>

      {% if user.is_authenticated %}
        <li><a href="{% url 'dash' %}" class="hover:text-yellow-400 transition">Dash</a></li>
        {% if request.user.is_superuser %}
          <li><a href="{% url 'admin:index' %}" class="hover:text-yellow-400 transition">Administrador</a></li>
        {% endif %}
        <li class="text-center">
          <form method="post" action="{% url 'logout' %}">
            {% csrf_token %}
            <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-4 py-1.5 rounded text-sm font-medium transition duration-200 w-full">
              Cerrar sesión
            </button>
          </form>
        </li>
      {% else %}
        <li>
          <a href="{% url 'login' %}" class="bg-yellow-500 hover:bg-yellow-600 text-black px-5 py-2 rounded font-semibold text-sm transition duration-200 w-full text-center block">
            Iniciar sesión
          </a>
        </li>
      {% endif %}
    </ul>
  </div>
</header>

  <!-- Contenido principal -->
  <main class="flex-grow pt-24"> <!-- pt-24 para compensar el header fijo (~96px) -->
    <div class="content-area" id="main-content">
      {% block content %}{% endblock %}
      
      <!-- BLOQUE DE MENSAJES DJANGO → TOASTS -->
      {% if messages %}
      <script>
      // --- Bloque Django dentro del script (Evita errores JS) ---
      document.addEventListener("DOMContentLoaded", function () {

          /* {% for message in messages %} */
          mostrarAlerta("{{ message|escapejs }}","{{ message.tags }}");
          /* {% endfor %} */

      });
      </script>
      {% endif %}
    </div>
  </main>

  <!-- Contenedor de alertas -->
  <div id="toast-container" class="fixed top-5 right-5 z-[9999] space-y-3"></div>
  <!-- Footer global opcional -->
  {% block footer %}{% endblock %}

  <!-- Scripts comunes -->
  {% block scripts %}{% endblock %}
  <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>

  <!-- NOTA: Eliminé los scripts de Bootstrap y MDB porque ya no usamos sus clases -->
  <!-- Si usás modales de Bootstrap en otras vistas, deberás reemplazarlos por modales en Tailwind o Alpine.js -->

  <script>
    function mostrarAlerta(mensaje, tipo = "success") {
      const colores = {
          success: "bg-green-500/80 border-green-300",
          error: "bg-red-500/80 border-red-300",
          warning: "bg-yellow-500/80 border-yellow-300",
          info: "bg-blue-500/80 border-blue-300"
      };

      const toast = document.createElement("div");
      toast.className = `
          glass text-white px-4 py-3 rounded-xl shadow-lg border
          ${colores[tipo] || colores.success}
          animate-fade-in-up
      `;
      toast.innerHTML = `<span>${mensaje}</span>`;

      document.getElementById("toast-container").appendChild(toast);

      setTimeout(() => {
          toast.classList.add("opacity-0", "transition");
          setTimeout(() => toast.remove(), 500);
      }, 3000);
    }
    /* ------------------------------ */
    /* MENÚ MÓVIL                     */
    /* ------------------------------ */
    const menuBtn = document.getElementById('menu-btn');
    const mobileMenu = document.getElementById('mobile-menu');

    menuBtn.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
    });


    /* ------------------------------ */
    /* DROPDOWN DE USUARIO            */
    /* ------------------------------ */
    const userMenu = document.getElementById("user-menu");
    const dropdown = document.getElementById("user-dropdown");
    let hideTimeout;

    if (userMenu) {
        userMenu.addEventListener("mouseenter", () => {
            clearTimeout(hideTimeout);
            dropdown.classList.remove("hidden");
        });

        userMenu.addEventListener("mouseleave", () => {
            hideTimeout = setTimeout(() => {
                dropdown.classList.add("hidden");
            }, 200);
        });
    }


    /* ------------------------------ */
    /* FUNCIÓN GLOBAL AJAX            */
    /* ------------------------------ */
    function cargarContenido(url) {
        $.ajax({
            url: url,
            method: 'GET',
            headers: { 'X-Requested-With': 'XMLHttpRequest' },
            success: function(respuesta) {

                // Si devuelve HTML completo → redirigimos
                if (respuesta.includes('<html')) {
                    window.location.href = url;
                    return;
                }

                // Si aparece login → redirigir
                if (respuesta.includes('name="username"')) {
                    window.location.href = "{% url 'login' %}";
                    return;
                }

                $("#main-content").html(respuesta);
            },
            error: function(e) {
                console.error("Error AJAX:", e);
            }
        });
    }


    /* ------------------------------ */
    /* EVENTOS PARA CARGAR VISTAS     */
    /* ------------------------------ */
    $(document).on("click", "#divContacto, #divmobileContacto", function(e) {
        e.preventDefault();
        cargarContenido("{% url 'contacto' %}");
    });

    $(document).on("click", "#divPerfil", function(e) {
        e.preventDefault();
        cargarContenido("{% url 'perfil_cliente' %}");
    });

    $(document).on("click", "#divMisturnos", function(e) {
        e.preventDefault();
        cargarContenido("{% url 'mis_turnos' %}");
    });

    /* ------------------------------ */
    /* VALIDACIONES FORMULARIO CONTACTO */
    /* ------------------------------ */
    document.addEventListener("input", function (e) {
        const id = e.target.id;

        const reglas = {
            nombre: /^[A-Za-zÁÉÍÓÚáéíóúÑñ ]+$/,
            apellido: /^[A-Za-zÁÉÍÓÚáéíóúÑñ ]+$/,
            email: /^[^\s@]+@[^\s@]+\.[^\s@]+$/,
            telefono: /^[0-9]*$/
        };

        if (reglas[id]) {
            validarCampo(e.target, reglas[id], `error-${id}`, "Formato no válido.");
        }

        if (id === "mensaje") {
            const error = document.getElementById("error-mensaje");
            error.textContent = e.target.value.trim() === "" ? "El mensaje es obligatorio." : "";
        }
    });

    function validarCampo(input, regex, errorId, mensaje) {
        const error = document.getElementById(errorId);
        if (input.value === "") {
            error.textContent = "";
            return;
        }
        error.textContent = regex.test(input.value) ? "" : mensaje;
    }
  </script>

</body>
</html>