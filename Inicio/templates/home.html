{% load static %}
<div class="card">
    <div id="inicio-container" class="p-6 space-y-6" data-url="{% url 'home' %}">

        <!-- Secci√≥n general -->
        <div class="text-center">
            <h2 class="text-2xl font-bold text-yellow-400">¬°Bienvenido {{ empleado.user.first_name }}!</h2>
        </div>

        <!-- Secci√≥n Barbero -->
        {% if especialidad == 'Barbero' %}
            <div class="bg-neutral-900 text-gray-200 antialiased">
                <div class="max-w-5xl mx-auto px-4">
                    <!-- Encabezado -->
                    <header class="mb-6 flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold text-yellow-400">Mi Agenda</h1>
                        <p class="text-neutral-400 text-sm mt-1">Turnos y pr√≥ximos servicios</p>
                    </div>
                    </header>

                    <!-- Resumen r√°pido de estado -->
                    <section class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-neutral-800 rounded-lg p-4 flex items-center justify-between">
                        <div>
                        <p class="text-neutral-400 text-sm">Turnos completados</p>
                        <h2 class="text-2xl font-bold text-green-400">{{completados}}</h2>
                        </div>
                        <i class="fa-solid fa-check-circle text-green-400 text-2xl"></i>
                    </div>

                    <div class="bg-neutral-800 rounded-lg p-4 flex items-center justify-between">
                        <div>
                        <p class="text-neutral-400 text-sm">Turnos pendientes</p>
                        <h2 class="text-2xl font-bold text-yellow-400">{{pendientes}}</h2>
                        </div>
                        <i class="fa-solid fa-clock text-yellow-400 text-2xl"></i>
                    </div>

                    <div class="bg-neutral-800 rounded-lg p-4 flex items-center justify-between">
                        <div>
                        <p class="text-neutral-400 text-sm">Cancelados</p>
                        <h2 class="text-2xl font-bold text-red-400">{{cancelados}}</h2>
                        </div>
                        <i class="fa-solid fa-xmark-circle text-red-400 text-2xl"></i>
                    </div>
                    </section>

                    <!-- Turnos del d√≠a -->
                    <section class="bg-neutral-800 p-4 rounded-lg mb-6">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-semibold text-yellow-400">Turnos de Hoy</h3>
                        <span class="text-xs text-neutral-400">{{hoy}}</span>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm text-gray-300">
                        <thead class="bg-neutral-700">
                            <tr>
                            <th class="px-3 py-2 text-left">Hora</th>
                            <th class="px-3 py-2 text-left">Cliente</th>
                            <th class="px-3 py-2 text-left">Estado</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for turno in turnoshoy %}
                                <tr class="border-b border-neutral-800">
                                <td class="px-3 py-2">{{ turno.horario.hora_inicio|time:"H:i" }}</td>
                                <td class="px-3 py-2">{{ turno.cliente }}</td>
                                <td class="px-3 py-2">{{ turno.estado.nombre }}</td>
                                </tr>
                            {% empty %}
                                <tr>
                                    <td colspan="3">No hay turnos para hoy</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                        </table>
                    </div>
                    </section>

                    <!-- Pr√≥ximos turnos -->
                    <section class="bg-neutral-800 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold mb-3 text-yellow-400">Pr√≥ximos Turnos (Semana)</h3>
                    <ul class="divide-y divide-neutral-700 text-sm max-h-72 overflow-y-auto">
                        {% for semana in turnos_semana %}
                        <li class="py-3 flex justify-between">
                        <span>{{ semana.fecha|date:"D" }}, {{ semana.fecha|date:"d/m" }}  -  {{ semana.horario.hora_inicio|time:"H:i" }}</span>
                        <span class="text-neutral-300">{{ semana.cliente.first_name }} {{ semana.cliente.last_name }}</span>
                        </li>
                        {% endfor%}
                    </ul>
                    </section>
                </div>
            </div>
        {% endif %}

        <!-- Secci√≥n Recepcionista -->
        {% if especialidad == 'Recepcionista' %}
        <div class="bg-neutral-900 text-gray-200 antialiased">
            <div class="max-w-6xl mx-auto px-4">
                <!-- Encabezado -->
                <header class="mb-6 flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                <div>
                    <h1 class="text-3xl font-bold text-yellow-400">Panel de Recepci√≥n</h1>
                    <p class="text-neutral-400 text-sm mt-1">Gesti√≥n diaria y control de caja</p>
                </div>
                </header>

                <!-- Fila 1: Turnos del d√≠a + Accesos r√°pidos -->
                <section class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <!-- Caja actual -->
                <div class="bg-neutral-800 p-4 rounded-lg md:col-span-2">
                    <h3 class="text-lg font-semibold mb-3 text-yellow-400">Caja Actual</h3>

                    <div class="grid grid-cols-3 gap-4 mb-4">
                    <div class="p-3 bg-neutral-900 rounded-lg text-center">
                        <p class="text-neutral-400 text-sm mb-1">Efectivo</p>
                        <h2 class="text-2xl font-bold text-green-400">$ {{ efectivo|floatformat:2 }}</h2>
                    </div>
                    <div class="p-3 bg-neutral-900 rounded-lg text-center">
                        <p class="text-neutral-400 text-sm mb-1">Tarjeta</p>
                        <h2 class="text-2xl font-bold text-blue-400">$ {{ tarjeta|floatformat:2 }}</h2>
                    </div>
                    <div class="p-3 bg-neutral-900 rounded-lg text-center">
                        <p class="text-neutral-400 text-sm mb-1">Otros</p>
                        <h2 class="text-2xl font-bold text-yellow-400">$ {{ otros|floatformat:2 }}</h2>
                    </div>
                    </div>

                    <div class="text-right text-sm text-neutral-400">
                    Total en caja: <span class="text-gray-100 font-semibold">$ {{ total_caja|floatformat:2 }}</span>
                    </div>
                </div>

                <!-- Accesos r√°pidos -->
                <div class="bg-neutral-800 p-4 rounded-lg">
                    <h3 class="text-lg font-semibold mb-4 text-yellow-400">Accesos R√°pidos</h3>
                    <div class="flex flex-col gap-3">
                    <button data-url="{% url 'dar_turno' %}" data-titulo="Nuevo Turno" class="btn-ajax-form bg-yellow-500 hover:bg-yellow-600 text-neutral-900 font-semibold py-2 rounded">
                        <i class="fa fa-calendar-check mr-2"></i>Nuevo Turno
                    </button>
                    <button data-url="{% url 'formcli' %}" data-titulo="Nuevo Cliente" class="btn-ajax-form bg-neutral-700 hover:bg-neutral-600 text-gray-200 font-semibold py-2 rounded">
                        <i class="fa fa-user mr-2"></i>Nuevo Cliente
                    </button>
                    <button data-url="{% url 'crear_venta' %}" data-titulo="Nuevo Venta" class="btn-ajax-form bg-yellow-500 hover:bg-yellow-600 text-neutral-900 font-semibold py-2 rounded">
                        <i class="fa fa-cash-register mr-2"></i>Nueva Venta
                    </button>
                    </div>
                </div>
                </section>

                
            </div>
        </div>
        {% endif %}

        <!-- Secci√≥n Gerente -->
        {% if especialidad == 'Gerente' %}
        <div class="bg-neutral-900 text-gray-200 antialiased">
            <div class="max-w-6xl mx-auto px-4">
                
                <header class="mb-6">
                    <h1 class="text-3xl font-bold text-yellow-400">Panel de Gerencia</h1>
                    <p class="text-neutral-400 text-sm mt-1">Resumen general y turnos del d√≠a</p>
                </header>

                <section class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-neutral-800 p-4 rounded-lg flex items-center justify-between">
                        <div>
                            <p class="text-neutral-400 text-sm">Ventas del d√≠a</p>
                            <h2 class="text-3xl font-extrabold text-yellow-400">$ {{total_hoy}}</h2>
                        </div>
                        <i class="fa-solid fa-sack-dollar text-yellow-400 text-3xl"></i>
                    </div>
                    <div class="bg-neutral-800 p-4 rounded-lg flex items-center justify-between">
                        <div>
                            <p class="text-neutral-400 text-sm">Servicios completados</p>
                            <h2 class="text-3xl font-extrabold text-green-400">{{total_completados_hoy}}</h2>
                            <p class="text-xs text-neutral-400 mt-1">Pendientes: {{total_pendientes_hoy}}</p>
                        </div>
                        <i class="fa-solid fa-scissors text-green-400 text-3xl"></i>
                    </div>
                    <div class="bg-neutral-800 p-4 rounded-lg flex items-center justify-between">
                        <div>
                            <p class="text-neutral-400 text-sm">Caja actual</p>
                            <h2 class="text-3xl font-extrabold text-blue-400">$ {{monto_total_caja}}</h2>
                            <p class="text-xs text-neutral-400 mt-1">√ölt. mov.: +${{venta_mas_reciente_total}}</p>
                        </div>
                        <i class="fa-solid fa-cash-register text-blue-400 text-3xl"></i>
                    </div>
                </section>

                <section class="grid grid-cols-1 lg:grid-cols-4 gap-4 mb-6">
                    
                    <div class="bg-neutral-800 p-4 rounded-lg lg:col-span-1">
                        <h3 class="text-lg font-semibold text-yellow-400 mb-2">Productos vs Servicios</h3>
                        <div class="h-64"> 
                            <canvas id="chartIngresos" class="w-full h-full"></canvas>
                        </div>
                    </div>

                    <div class="bg-neutral-800 p-4 rounded-lg lg:col-span-3">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-lg font-semibold text-yellow-400">Rendimiento por Empleado y Monto a pagar (hoy)</h3>
                            <span class="text-xs text-neutral-400">Datos Actualizados</span>
                        </div>
                        <div class="overflow-x-auto">
                            <table id="tabla-rendimiento-barberos" class="min-w-full text-sm"> 
                                <thead class="bg-neutral-700 text-gray-200">
                                    <tr>
                                        <th class="px-3 py-2 text-left">Empleado</th>
                                        <th class="px-3 py-2 text-left">Turnos</th>
                                        <th class="px-3 py-2 text-left">Servicios</th>
                                        <th class="px-3 py-2 text-left">Ingresos</th>
                                        <th class="px-3 py-2 text-left">Ganancia</th>
                                        <th class="px-3 py-2 text-left">A pagar</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    </tbody>
                            </table>
                        </div>
                    </div>
                    
                </section>

                <section class="grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6">
                    
                    <div class="bg-neutral-800 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-yellow-400 mb-4">Tendencia Diaria de Ingresos</h3>
                        <div class="h-80"> 
                            <canvas id="chartLinealDiario" class="w-full h-full"></canvas>
                        </div>
                    </div>
                    
                    <div class="bg-neutral-800 p-4 rounded-lg">
                        <h3 class="text-lg font-semibold text-yellow-400 mb-4">An√°lisis Semanal de Turnos</h3>
                        <div class="h-80"> 
                            <canvas id="chartTurnosBarras" class="w-full h-full"></canvas>
                        </div>
                    </div>
                    
                </section>

            </div>
        </div>
        {% endif %}

        {% if especialidad == 'Gerente' or especialidad == 'Recepcionista' %}
        <!-- TABLA DE TURNOS PARA GERENTE Y RECEPCION -->
            <div class="bg-neutral-900 text-gray-200 antialiased">
                <div class="max-w-6xl mx-auto px-4 pb-6">
                    <section class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="bg-neutral-800 p-4 rounded-lg md:col-span-2">
                        <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-semibold text-yellow-400">Turnos del D√≠a</h3>
                        <span class="text-xs text-neutral-400">{{hoy}}</span>
                        </div>

                        <div id="tablaturnosrecep" class="overflow-x-auto">
                            <table class="min-w-full text-sm text-gray-300">
                                <thead class="bg-neutral-700">
                                    <tr>
                                        <th class="px-3 py-2 text-left">Hora</th>
                                        <th class="px-3 py-2 text-left">Cliente</th>
                                        <th class="px-3 py-2 text-left">Peluquero</th>
                                        <th class="px-3 py-2 text-left">Estado</th>
                                        <th class="px-3 py-2 text-left">Cobrar</th> <!-- Nueva columna -->
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for turno in turnostodos %}
                                    <tr class="border-b border-neutral-800">
                                        <td class="px-3 py-2">{{ turno.horario.hora_inicio|time:"H:i" }}</td>
                                        <td class="px-3 py-2">{{ turno.cliente }}</td>
                                        <td class="px-3 py-2">{{ turno.empleado }}</td>
                                        <td class="px-3 py-2">{{ turno.estado.nombre }}</td>
                                        <td class="px-3 py-2">
                                            {% if turno.estado.nombre == 'cancelado' %}
                                                <span class="text-gray-400 font-semibold">---</span>

                                            {% elif not turno.pagado %}
                                                <button 
                                                    class="btn-ajax-form bg-green-600 text-black py-1 px-3 rounded"
                                                    data-url="{% url 'cobrar_turno' turno.id %}"
                                                    data-titulo="Cobrar Turno">
                                                    Cobrar
                                                </button>

                                            {% else %}
                                                <span class="text-green-400 font-semibold">Pagado</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="5" class="text-center">No hay turnos para hoy</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    </section>
                </div>
            </div>
        {% endif %}
    </div>
</div>

<script>

    // ----------------------------------------------------
    // GR√ÅFICO 1: TORTA (Ingresos Productos vs Servicios)
    // ----------------------------------------------------
    function iniciarGraficoIngresos() {
        const canvas = document.getElementById("chartIngresos");
        if (!canvas) {
            console.log("DEPURACI√ìN: Canvas 'chartIngresos' no encontrado.");
            return;
        }
        
        const ctx = canvas.getContext("2d");
        const urlDatos = "{% url 'datos_torta' %}";
        
        fetch(urlDatos)
            .then(response => {
                if (!response.ok) throw new Error(`Error HTTP! Estado: ${response.status}`);
                return response.json();
            })
            .then(data => {
                console.log("DEPURACI√ìN: Datos Torta recibidos:", data);
                
                let ingresosServicios = data.ingresos_servicios || 0;
                let ingresosProductos = data.ingresos_productos || 0;
                const totalIngresos = ingresosServicios + ingresosProductos;
                
                if (totalIngresos === 0) {
                    ctx.font = "16px sans-serif";
                    ctx.fillStyle = "#A1A1AA"; 
                    ctx.textAlign = "center";
                    // Aseguramos que el texto se dibuje en el centro del contenedor (si no est√° estirado)
                    ctx.fillText("No hay datos de ingresos esta semana.", canvas.width / 2, canvas.height / 2);
                    return; 
                }

                if (window.graficoTorta) { window.graficoTorta.destroy(); }

                window.graficoTorta = new Chart(ctx, {
                    type: "pie",
                    data: {
                        labels: ["Servicios", "Productos"],
                        datasets: [{
                            data: [ingresosServicios, ingresosProductos],
                            backgroundColor: [
                                '#f59e0b', // Amarillo/Naranja 
                                '#3b82f6'  // Azul 
                            ], 
                            hoverOffset: 16
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        layout: { padding: 10 },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'bottom',
                                labels: { color: '#e5e5e5' }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.label || '';
                                        if (label) { label += ': '; }
                                        const value = new Intl.NumberFormat('es-AR', {
                                            style: 'currency',
                                            currency: 'ARS',
                                            minimumFractionDigits: 0
                                        }).format(context.raw);
                                        return label + value;
                                    }
                                }
                            }
                        }
                    }
                });
            })
            .catch(error => {
                console.error("DEPURACI√ìN: Error en el gr√°fico de torta:", error);
            });
    }


    // ----------------------------------------------------
    // üÜï GR√ÅFICO 2: LINEAL (Tendencia Diaria)
    // ----------------------------------------------------
    function iniciarGraficoLineal() {
        const canvas = document.getElementById("chartLinealDiario");
        if (!canvas) {
            console.log("DEPURACI√ìN: Canvas 'chartLinealDiario' no encontrado.");
            return;
        }
        
        const ctx = canvas.getContext("2d");
        const urlDatos = "{% url 'datos_lineal' %}"; // Usamos la nueva URL
        
        fetch(urlDatos)
            .then(response => {
                if (!response.ok) throw new Error(`Error HTTP! Estado: ${response.status}`);
                return response.json();
            })
            .then(data => {
                console.log("DEPURACI√ìN: Datos Lineal recibidos:", data);
                
                const labels = data.labels; // Lun, Mar, Mi√©...
                const ingresosData = data.data; // [100, 200, 0, 0, ...]
                const totalIngresos = ingresosData.reduce((sum, current) => sum + current, 0);

                if (totalIngresos === 0) {
                    // Si el total es 0, dibujamos el mensaje en el canvas
                    ctx.font = "16px sans-serif";
                    ctx.fillStyle = "#A1A1AA"; 
                    ctx.textAlign = "center";
                    ctx.fillText("No hay ingresos registrados esta semana.", canvas.width / 2, canvas.height / 2);
                    return; 
                }

                if (window.graficoLineal) { window.graficoLineal.destroy(); }

                window.graficoLineal = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Ingresos Diarios (ARS)',
                            data: ingresosData,
                            backgroundColor: 'rgba(245, 158, 11, 0.2)', // Fondo suave
                            borderColor: '#f59e0b', // L√≠nea principal (Amarillo/Naranja)
                            pointBackgroundColor: '#f59e0b',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: '#f59e0b',
                            borderWidth: 2,
                            fill: true, // Rellenar debajo de la l√≠nea
                            tension: 0.4 // Curva suave
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        layout: { padding: 5 },
                        scales: {
                            y: {
                                beginAtZero: true,
                                grid: { color: 'rgba(255, 255, 255, 0.1)' }, // L√≠neas de grid tenues
                                ticks: {
                                    color: '#e5e5e5', // Color de los n√∫meros del eje Y
                                    callback: function(value) {
                                        return '$' + new Intl.NumberFormat('es-AR').format(value); // Formato ARS
                                    }
                                }
                            },
                            x: {
                                grid: { display: false },
                                ticks: { color: '#e5e5e5' } // Color de los d√≠as
                            }
                        },
                        plugins: {
                            legend: {
                                display: false, // La etiqueta es clara en la l√≠nea
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) { label += ': '; }
                                        const value = new Intl.NumberFormat('es-AR', {
                                            style: 'currency',
                                            currency: 'ARS',
                                            minimumFractionDigits: 0
                                        }).format(context.raw);
                                        return value;
                                    }
                                }
                            }
                        }
                    }
                });
            })
            .catch(error => {
                console.error("DEPURACI√ìN: Error en el gr√°fico lineal:", error);
            });
    }
    function iniciarGraficoTurnos() {
        const canvas = document.getElementById("chartTurnosBarras");
        if (!canvas) {
            console.warn("Canvas 'chartTurnosBarras' no encontrado. Aseg√∫rese de que el ID est√© en el HTML.");
            return;
        }
        
        const ctx = canvas.getContext("2d");
        // ‚ö†Ô∏è Aseg√∫rate de que esta URL sea correcta. Si est√°s en un template de Django, usa:
        // const urlDatos = "{% url 'datos_turnos' %}"; 
        // Si no est√°s en un template, usa la URL directa:
        const urlDatos = "/datos-turnos/"; 
        
        fetch(urlDatos)
            .then(response => {
                if (!response.ok) throw new Error(`Error HTTP! Estado: ${response.status}`);
                return response.json();
            })
            .then(data => {
                console.log("DEPURACI√ìN: Datos Turnos recibidos:", data);
                
                const labels = data.labels; // Lun, Mar, Mi√©...
                const completadosData = data.completados || [];
                const canceladosData = data.cancelados || [];
                
                const totalTurnos = completadosData.reduce((sum, current) => sum + current, 0) +
                                    canceladosData.reduce((sum, current) => sum + current, 0);

                if (totalTurnos === 0) {
                    // Si no hay datos, muestra un mensaje en el canvas
                    ctx.font = "16px sans-serif";
                    ctx.fillStyle = "#A1A1AA"; 
                    ctx.textAlign = "center";
                    ctx.fillText("No hay turnos Completados o Cancelados esta semana.", canvas.width / 2, canvas.height / 2);
                    return; 
                }

                // Destruye la instancia anterior si existe (para refrescos)
                if (window.graficoTurnos) { window.graficoTurnos.destroy(); }

                window.graficoTurnos = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Completados',
                                data: completadosData,
                                backgroundColor: '#10b981', // Verde esmeralda
                                borderRadius: 6,
                            },
                            {
                                label: 'Cancelados',
                                data: canceladosData,
                                backgroundColor: '#ef4444', // Rojo
                                borderRadius: 6,
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        layout: { padding: 10 },
                        scales: {
                            x: {
                                stacked: false, // Barras agrupadas (una al lado de la otra)
                                grid: { display: false },
                                ticks: { color: '#e5e5e5' }
                            },
                            y: {
                                stacked: false,
                                beginAtZero: true,
                                grid: { color: 'rgba(255, 255, 255, 0.1)' },
                                ticks: {
                                    color: '#e5e5e5',
                                    precision: 0 
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                                labels: { color: '#e5e5e5' }
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) { label += ': '; }
                                        return label + context.raw + ' turnos';
                                    }
                                }
                            }
                        }
                    }
                });
            })
            .catch(error => {
                console.error("Error al obtener datos del gr√°fico de turnos:", error);
            });
    }

    function cargarTablaRendimientoBarberos() {
        // 1. URL de la API (Aseg√∫rate que esta URL coincida con tu urls.py)
        const apiUrl = "{% url 'datos_barberos' %}"; 
        
        // 2. Contenedor del cuerpo de la tabla (tbody) donde insertaremos las filas
        const $tbody = $('#tabla-rendimiento-barberos tbody');
        
        // Opcional: Mostrar un loader mientras se cargan los datos
        $tbody.html('<tr><td colspan="6" class="text-center py-4 text-neutral-400">Cargando datos...</td></tr>');

        $.ajax({
            url: apiUrl,
            method: 'GET',
            dataType: 'json',
            success: function(data) {
                $tbody.empty(); // Limpiar el contenido previo del tbody

                if (data.length === 0) {
                    // Si no hay barberos o datos hoy
                    $tbody.append('<tr><td colspan="6" class="text-center py-4 text-neutral-400">No hay datos de barberos completados hoy.</td></tr>');
                    return;
                }

                // Iterar sobre cada objeto de datos devuelto por la vista Django
                data.forEach(function(barbero, index) {

                    const turnosCompletados = barbero.turnos_completados; 
                    const serviciosRealizados = barbero.detalles_count;   
                    // Asegurar que los valores monetarios sean n√∫meros para darles formato de moneda
                    const ingresos = parseFloat(barbero.ingresos).toFixed(0);    
                    const ganancia = parseFloat(barbero.ganancia).toFixed(0); 
                    const a_pagar = parseFloat(barbero.a_pagar).toFixed(0);

                    // Determinar si es la √∫ltima fila para no poner el border-b
                    const isLastRow = index === data.length - 1;
                    const rowClass = isLastRow ? '' : 'border-b border-neutral-800';

                    // Crear la fila HTML
                    const fila = `
                        <tr class="${rowClass}">
                            <td class="px-3 py-2">${barbero.nombre_completo}</td>
                            <td class="px-3 py-2">${turnosCompletados}</td> 
                            <td class="px-3 py-2">${serviciosRealizados}</td> 
                            <td class="px-3 py-2 text-green-400">$ ${ingresos}</td>
                            <td class="px-3 py-2 text-green-400">$ ${ganancia}</td>
                            <td class="px-3 py-2 text-green-400">$ ${a_pagar}</td>
                        </tr>
                    `;
                    
                    $tbody.append(fila); // Agregar la fila al cuerpo de la tabla
                });
            },
            error: function(xhr, status, error) {
                console.error('Error al cargar los datos de rendimiento:', error);
                $tbody.html('<tr><td colspan="6" class="text-center py-4 text-red-400">‚ùå Error al cargar los datos.</td></tr>');
            }
        });
    }
    
    // Llamamos a ambas funciones en la carga del DOM y directamente (para AJAX/HTMX)
    document.addEventListener("DOMContentLoaded", iniciarGraficoIngresos);
    document.addEventListener("DOMContentLoaded", iniciarGraficoLineal);
    document.addEventListener("DOMContentLoaded", iniciarGraficoTurnos);
    
    // Llamada directa como respaldo para carga din√°mica
    iniciarGraficoIngresos();
    iniciarGraficoLineal();
    iniciarGraficoTurnos();

    // Ejecutar la funci√≥n cuando el documento est√© listo
    $(document).ready(function() {
        cargarTablaRendimientoBarberos();
    });

</script>