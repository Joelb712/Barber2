{% load static %}
<table id="listacajas" class="min-w-full divide-y divide-gray-200">
    <thead class="bg-slate-700">
        <tr>
            <th class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">Nro Caja</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">Fecha Apertura</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">Fecha Cierre</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">Monto Inicial</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">Monto Final</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">Estado</th>
            <th class="px-4 py-3 text-left text-xs font-medium text-white uppercase tracking-wider">Acciones</th>
        </tr>
    </thead>
    <tbody class="bg-gray-300 divide-y divide-gray-200">
        {% for c in cajas %}
        <tr data-pk="{{ c.pk }}" class="hover:bg-amber-100">
            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-black">{{ c.id }}</td>
            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-black">{{ c.fecha_apertura }}</td>
            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-black">{{ c.fecha_cierre|default:"--" }}</td>
            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-black">$ {{ c.monto_inicial|floatformat:2 }}</td>
            <td class="px-4 py-3 whitespace-nowrap text-sm font-medium text-black">$ {{ c.monto_final|default:"--"}}</td>
            <td class="px-4 py-3 whitespace-nowrap">
                <span class="px-2 inline-flex text-sm leading-5 font-semibold rounded-full 
                {% if c.estado %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %}">
                {{ c.estado|yesno:"Abierta,Cerrada" }}
                </span>
            </td>
            <td class="px-4 py-3 whitespace-nowrap text-m font-medium">
                {% if c.estado %}
                <button class="btnCerrar text-red-600 hover:text-red-800 mr-2" data-caja-id="{{ c.pk }}" title="Cerrar Caja">
                    <i class="fas fa-lock"></i>
                </button>
                {% else %}
                <button class="btnVer text-blue-600 hover:text-blue-800 mr-2" data-caja-id="{{ c.pk }}" title="Ver Detalles">
                    <i class="fas fa-eye"></i>
                </button>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
<script>
    // ðŸ’¡ INICIALIZACIÃ“N GARANTIZADA DE DATATABLES ðŸ’¡
    $(function() {
        
        // 1. Destruir DataTables anterior si existe (CLAVE para AJAX)
        if ($.fn.DataTable.isDataTable('#listacajas')) {
            $('#listacajas').DataTable().destroy();
        }

        // 2. Inicializar la tabla de CAJAS
        $('#listacajas').DataTable({
            paging: true,
            searching: true,
            ordering: true,
            
            // ðŸ›‘ ORDENACIÃ“N POR DEFECTO: Columna 1 (Fecha Apertura) de forma descendente (mÃ¡s reciente primero) ðŸ›‘
            order: [[1, 'desc']], 
            
            // Opciones de paginaciÃ³n
            lengthMenu: [
                [10, 20, 50, -1],
                [10, 20, 50, "Todos"]
            ],
            
            // Idioma en espaÃ±ol
            language: {
                url: "//cdn.datatables.net/plug-ins/1.10.25/i18n/Spanish.json"
            },
            responsive: true,
            dom: '<"flex justify-between items-center mb-4"Blf><"overflow-x-auto"rt><"flex justify-between items-center mt-4"ip>',
            buttons: [
            {
                extend: 'excelHtml5',
                text: 'Excel',
                title: 'Reporte de Cajas'
            },
            // BotÃ³n para PDF (requiere PDFMake)
            {
                extend: 'pdfHtml5',
                text: 'PDF',
                title: 'Reporte de Cajas',
                orientation: 'landscape',
                exportOptions: {
                    // ðŸ›‘ Excluye la Columna 5 (Acciones) ðŸ›‘
                    columns: [0, 1, 2, 3, 4] 
                },
                customize: function (doc) {
                    doc.content[1].table.widths = Array(doc.content[1].table.body[0].length + 1).join('*').split('');
                }
            },
        ]
        });
    });
</script>